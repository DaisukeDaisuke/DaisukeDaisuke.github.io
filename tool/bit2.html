<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitwise Operations</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        .container {
            margin: 20px;
        }
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            width: 200px;
        }
        .checkbox-container label {
            width: 25%;
            display: flex;
            align-items: center;
        }
        .checkbox-container input {
            margin-right: 5px;
        }
        .buttons {
            margin-top: 20px;
        }
        .buttons button {
            margin: 5px;
            padding: 10px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <textarea id="textarea" rows="4" cols="50"></textarea>
    </div>
    <div class="checkbox-container">
        <!-- Checkbox inputs -->
        <script>
            // Generated by chatGPT https://chatgpt.com/share/9fc3c2b1-5eac-45cf-b3df-d6d9a34c7bb8
            for (let i = 0; i < 32; i++) {
                document.write(`<label><input type="checkbox" class="bit-checkbox" data-bit="${i}">${i}</label>`);
            }
        </script>
    </div>
    <div class="container">
        <input type="text" id="operation-value" placeholder="Enter value">
    </div>
    <div class="buttons">
        <button onclick="shiftRight()">→右シフト</button>
        <button onclick="shiftLeft()">←左シフト</button>
        <button onclick="bitwiseAnd()">&アンド</button>
        <button onclick="bitwiseOr()">or</button>
        <button onclick="rotateRight()">ror</button>
        <button onclick="arithShiftRight()">asr</button>
        <button onclick="subtract()">-</button>
        <button onclick="add()">+</button>
        <button onclick="undo()">Undo</button>
    </div>

    <script>
        let previousValue = null;

        document.getElementById('textarea').addEventListener('input', updateCheckboxes);
        document.querySelectorAll('.bit-checkbox').forEach(cb => cb.addEventListener('change', updateTextarea));

        function updateCheckboxes() {
            const textarea = document.getElementById('textarea').value;
            let value = parseInput(textarea);
            if (value === null) return;

            document.querySelectorAll('.bit-checkbox').forEach(cb => {
                const bit = BigInt(cb.getAttribute('data-bit'));
                cb.checked = (value & (1n << bit)) !== 0n;
            });
        }

        function updateTextarea() {
            let value = 0n;
            document.querySelectorAll('.bit-checkbox').forEach(cb => {
                const bit = BigInt(cb.getAttribute('data-bit'));
                if (cb.checked) value |= (1n << bit);
            });
            document.getElementById('textarea').value = `0x${value.toString(16)}`;
        }

        function parseInput(input) {
            try {
                if (!input) return null;
                if (input.startsWith('0x')) {
                    return BigInt(input, 16);
                } else if (!isNaN(input)) {
                    return BigInt(input);
                } else {
                    return null;
                }
            } catch (SyntaxError) {
                return null;
            }
        }

        function shiftRight() {
            performOperation((a, b) => a >> b);
        }

        function shiftLeft() {
            performOperation((a, b) => a << b);
        }

        function bitwiseAnd() {
            performOperation((a, b) => a & b);
        }

        function bitwiseOr() {
            performOperation((a, b) => a | b);
        }

        function rotateRight() {
            performOperation((a, b) => {
                return (rightShift(a, b) | (leftShift(a, (32n - b)))) & 0xFFFFFFFFn;
            });
        }

        function arithShiftRight() {
            performOperation((a, b) => {
                return asr(a, b);
            });
        }

        function subtract() {
            performOperation((a, b) => a - b);
        }

        function add() {
            performOperation((a, b) => a + b);
        }

        function performOperation(operation) {
            const textarea = document.getElementById('textarea').value;
            const valueInput = document.getElementById('operation-value').value;
            const a = parseInput(textarea);
            const b = parseInput(valueInput);
            if (a === null || b === null) return;

            previousValue = textarea;
            const result = operation(a, b) & 0xFFFFFFFFn;
            document.getElementById('textarea').value = `0x${result.toString(16)}`;
            updateCheckboxes();
        }

        function undo() {
            if (previousValue === null) return;
            document.getElementById('textarea').value = previousValue;
            updateCheckboxes();
            previousValue = null;
        }

        function leftShift(num, shift) {
            return num * (2n ** shift);
        }

        function rightShift(num, shift) {
            return num / (2n ** shift);
        }

        function asr(value, shift) {
            const signBit = 0x80000000n;
            if (value & signBit) {
                value &= 0x7FFFFFFFn;
                for (let i = 0; i < shift; i++) {
                    value >>= 1n;
                    value |= signBit;
                }
            } else {
                value >>= shift;
            }
            return value & 0xFFFFFFFFn;
        }
    </script>
</body>
</html>
